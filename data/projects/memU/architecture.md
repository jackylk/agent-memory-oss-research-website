# memU æ¶æ„åˆ†æ

> åŸºäºå®é™…ä»£ç åº“åˆ†æ (memU v1.4.0)

## 1. æ•´ä½“æ¶æ„æ¦‚è¿°

**memU** æ˜¯ä¸€ä¸ªä¸º **24/7 é•¿æœŸè¿è¡Œçš„ AI ä»£ç†** è®¾è®¡çš„å†…å­˜ç®¡ç†æ¡†æ¶,æ ¸å¿ƒä½¿å‘½æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç° **æŒç»­å­¦ä¹ ã€è‡ªåŠ¨è®°å¿†ã€ä¸»åŠ¨æ™ºèƒ½** çš„ä»£ç†ç³»ç»Ÿã€‚

### é¡¹ç›®å®šä½

- **åº”ç”¨é¢†åŸŸ**:é•¿æœŸè¿è¡Œçš„ AI ä»£ç†ã€ä¸ªäººåŠ©æ‰‹ã€å¤šè½®å¯¹è¯ç³»ç»Ÿ
- **æ ¸å¿ƒä»·å€¼**:æ–‡ä»¶ç³»ç»Ÿå¼åˆ†å±‚è®°å¿† + æˆæœ¬ä¼˜åŒ– + å®æ—¶å¯ç”¨ + ä¸»åŠ¨å­¦ä¹ 
- **å…³é”®åˆ›æ–°**:åŒæ¨¡æ€æ£€ç´¢ã€å·¥ä½œæµç³»ç»Ÿã€é›¶å»¶è¿Ÿå¤„ç†ã€å¤šæä¾›å•†å…¼å®¹

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **æ–‡ä»¶ç³»ç»Ÿéšå–»**:å°†è®°å¿†ç»„ç»‡ä¸ºåˆ†å±‚ç›®å½•ç»“æ„,æ”¯æŒäº¤å‰å¼•ç”¨å’Œç¬¦å·é“¾æ¥
- **åŒæ¨¡æ€æ£€ç´¢**:RAG(å¿«é€ŸåµŒå…¥æœç´¢) + LLM(æ·±åº¦æ¨ç†)çš„æ··åˆæ£€ç´¢ç­–ç•¥
- **ä¸»åŠ¨å­¦ä¹ ç®¡é“**:æŒç»­ç›‘æ§ç”¨æˆ·äº¤äº’,è‡ªåŠ¨æå–çŸ¥è¯†ã€æŠ€èƒ½ã€è¡Œä¸ºæ¨¡å¼
- **é›¶å»¶è¿Ÿå¤„ç†**:è®°å¿†ç«‹å³å¯ç”¨,æ”¯æŒå®æ—¶ä¸Šä¸‹æ–‡æ³¨å…¥
- **å¤šæä¾›å•†å…¼å®¹**:OpenAIã€Grokã€Qwenã€Doubaoã€OpenRouter ç­‰ LLM æ— ç¼åˆ‡æ¢

### ä¸å…¶ä»–é¡¹ç›®çš„å·®å¼‚

| ç»´åº¦ | memU | Mem0 | Graphiti | Letta |
|------|------|------|----------|-------|
| **æ ¸å¿ƒæ¦‚å¿µ** | æ–‡ä»¶ç³»ç»Ÿå¼åˆ†å±‚è®°å¿† | æ‰å¹³åŒ–å‘é‡å­˜å‚¨ | çŸ¥è¯†å›¾è°±å‹ | å¯¹è¯å†å²å‹ |
| **æ¶æ„è®¾è®¡** | åˆ†å±‚ç›®å½•ç»“æ„ | å‘é‡ä¸ºä¸» | å›¾è°±ä¸ºä¸» | å†å²ä¸ºä¸» |
| **ä¸»åŠ¨æ€§** | âœ… 24/7 ä¸»åŠ¨ç›‘æ§ | âš ï¸ è¢«åŠ¨å“åº” | âœ… å›¾è°±æ¨ç† | âš ï¸ ååº”å¼ |
| **æˆæœ¬ä¼˜åŒ–** | âœ… æ ¸å¿ƒè®¾è®¡ç›®æ ‡ | âš ï¸ ä¼˜åŒ–æœ‰é™ | âš ï¸ å›¾éå†å¼€é”€å¤§ | âš ï¸ å®Œæ•´å†å²åŠ è½½ |
| **å¤šæ¨¡æ€** | âœ… æ–‡æœ¬/è§†é¢‘/éŸ³é¢‘/å›¾åƒ | âœ… åŸºç¡€æ”¯æŒ | âš ï¸ ä¸»è¦æ–‡æœ¬ | âš ï¸ ä¸»è¦å¯¹è¯ |
| **æ‰©å±•æ€§** | âœ… å·¥ä½œæµå¯å®šåˆ¶ | âœ… æ¨¡å—åŒ–ä½†æœ‰é™ | âš ï¸ å›¾è°±å›ºå®š | âš ï¸ æ¡†æ¶å›ºå®š |

---

## 2. æ ¸å¿ƒæ¶æ„ç»„ä»¶

### æ¶æ„åˆ†å±‚å›¾

```architecture
{
  "layers": [
    {
      "title": "åº”ç”¨å±‚",
      "icon": "ğŸ“±",
      "color": {
        "bg": "bg-blue-100",
        "border": "border-blue-600",
        "textColor": "#1e40af"
      },
      "nodes": [
        { "id": "A1", "label": "MemoryService æ ¸å¿ƒæ¥å£" },
        { "id": "A2", "label": "MemorizeMixin (å­˜å‚¨)" },
        { "id": "A3", "label": "RetrieveMixin (æ£€ç´¢)" },
        { "id": "A4", "label": "CRUDMixin (ç®¡ç†)" }
      ]
    },
    {
      "title": "å·¥ä½œæµå±‚",
      "icon": "âš™ï¸",
      "color": {
        "bg": "bg-blue-100",
        "border": "border-blue-600",
        "textColor": "#1e40af"
      },
      "nodes": [
        { "id": "B1", "label": "WorkflowRunner (æ‰§è¡Œå™¨)" },
        { "id": "B2", "label": "PipelineManager (ç®¡é“)" },
        { "id": "B3", "label": "WorkflowStep (æ­¥éª¤)" },
        { "id": "B4", "label": "WorkflowInterceptor (æ‹¦æˆªå™¨)" }
      ]
    },
    {
      "title": "æ™ºèƒ½å¤„ç†å±‚",
      "icon": "ğŸ§ ",
      "color": {
        "bg": "bg-blue-100",
        "border": "border-blue-600",
        "textColor": "#1e40af"
      },
      "nodes": [
        { "id": "C1", "label": "LLM å¤„ç†" },
        { "id": "C2", "label": "åµŒå…¥å¤„ç†" },
        { "id": "C3", "label": "å¤šæ¨¡æ€å¤„ç†" },
        { "id": "C4", "label": "æç¤ºå·¥ç¨‹" }
      ]
    },
    {
      "title": "å­˜å‚¨å±‚",
      "icon": "ğŸ’¾",
      "color": {
        "bg": "bg-blue-100",
        "border": "border-blue-600",
        "textColor": "#1e40af"
      },
      "nodes": [
        { "id": "D1", "label": "å…ƒæ•°æ®å­˜å‚¨" },
        { "id": "D2", "label": "å‘é‡ç´¢å¼•" },
        { "id": "D3", "label": "èµ„æºå­˜å‚¨" },
        { "id": "D4", "label": "ä»“åº“æ¥å£" }
      ]
    },
    {
      "title": "æ•°æ®æ¨¡å‹å±‚",
      "icon": "ğŸ“Š",
      "color": {
        "bg": "bg-blue-100",
        "border": "border-blue-600",
        "textColor": "#1e40af"
      },
      "nodes": [
        { "id": "E1", "label": "Resource (èµ„æº)" },
        { "id": "E2", "label": "MemoryItem (è®°å¿†é¡¹)" },
        { "id": "E3", "label": "MemoryCategory (åˆ†ç±»)" },
        { "id": "E4", "label": "CategoryItem (å…³ç³»)" }
      ]
    }
  ]
}
```

## 3. äº‘æœåŠ¡éœ€æ±‚è¯¦ç»†åˆ†æ

### 3.1 è®¡ç®—èµ„æºéœ€æ±‚

**å°è§„æ¨¡éƒ¨ç½²(1,000æ´»è·ƒç”¨æˆ·)**
- CPU:2-4 vCPU
- å†…å­˜:4-8GB
- å¹¶å‘:10-20 å¹¶å‘æ¨ç†è¯·æ±‚
- æ¨è:å…±äº«ä¸»æœºæˆ–å°å‹ VPS

**ä¸­ç­‰è§„æ¨¡(10,000ç”¨æˆ·)**
- CPU:8-16 vCPU
- å†…å­˜:16-32GB
- å¹¶å‘:100-200 è¯·æ±‚/ç§’
- æ¨è:Kubernetes é›†ç¾¤(3 Master + 5 Worker)

**å¤§è§„æ¨¡(100,000+ç”¨æˆ·)**
- CPU:64+ vCPU(åˆ†å¸ƒå¼)
- å†…å­˜:256+ GB
- å¹¶å‘:1000+ è¯·æ±‚/ç§’
- æ¨è:å¤§è§„æ¨¡ Kubernetes é›†ç¾¤

**ç”¨é€”å’Œæˆæœ¬ä¼˜åŠ¿**:
- LLM è¯·æ±‚è½¬å‘å’Œå“åº”å¤„ç†
- å‘é‡åµŒå…¥è®¡ç®—
- å¼‚æ­¥ä»»åŠ¡æ’é˜Ÿ
- ä¼šè¯ç®¡ç†å’Œç¼“å­˜

### 3.2 æ•°æ®åº“éœ€æ±‚

**å…ƒæ•°æ®å­˜å‚¨**

| è§„æ¨¡ | æ´»è·ƒç”¨æˆ· | è®°å¿†é¡¹ | å­˜å‚¨å®¹é‡ | æ¨èé…ç½® |
|------|---------|--------|--------|---------|
| å°å‹ | 1K | ~50K | 500MB | SQLite |
| ä¸­å‹ | 10K | ~500K | 5GB | PostgreSQL |
| å¤§å‹ | 100K+ | ~5M+ | 50GB+ | PostgreSQL Citus |

**ç”¨é€”å’Œç‰¹æ®Šéœ€æ±‚**:
- å­˜å‚¨å¯¹è¯æ¶ˆæ¯ã€äº‹å®ã€ä¼šè¯å…ƒæ•°æ®
- çŸ¥è¯†å›¾è°±å­˜å‚¨(è¯­ä¹‰ä¸‰å…ƒç»„)
- å®ä½“-æµç¨‹-ä¼šè¯ä¸‰å±‚è¿½è¸ª
- å¤‡ä»½:æ¯æ—¥å…¨é‡ + å°æ—¶å¢é‡
- æ¢å¤:æ—¶é—´ç‚¹æ¢å¤(PITR)èƒ½åŠ›

**æ‰©å±•ç­–ç•¥**:
- SQLite â†’ PostgreSQL(10K+ ç”¨æˆ·)
- PostgreSQL å•æœº â†’ Citus é›†ç¾¤(100K+ ç”¨æˆ·)
- æŒ‰ user_id åˆ†ç‰‡

### 3.3 å­˜å‚¨éœ€æ±‚

**èµ„æºå­˜å‚¨**

| ç±»å‹ | å¤§å° | ç”¨é€” |
|------|------|------|
| å¯¹è¯ JSON | 5-50KB | ä¼šè¯å†å² |
| æ–‡æ¡£ | 100KB-10MB | PDF/Markdown |
| å›¾åƒ | 500KB-5MB | æˆªå›¾/ä¸Šä¼  |
| è§†é¢‘ | 10-500MB | å½•åˆ¶/è®²åº§ |

**å®¹é‡éœ€æ±‚**:
- å°è§„æ¨¡:5GB(æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ)
- ä¸­ç­‰è§„æ¨¡:50GB(æœ¬åœ° NAS æˆ– S3)
- å¤§è§„æ¨¡:500GB+(åˆ†å¸ƒå¼å­˜å‚¨)

**æˆæœ¬**:
- æœ¬åœ°å­˜å‚¨:å…è´¹
- S3 Standard:$0.023/GB/æœˆ
- S3 + CloudFront:$0.085/GB å‡ºç«™æµé‡

### 3.4 å‘é‡æ•°æ®åº“éœ€æ±‚

**ç´¢å¼•ç±»å‹å’Œæ€§èƒ½**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|---------|
| **pgvector(HNSW)** | ä¸ PostgreSQL é›†æˆã€å…è´¹ | æŸ¥è¯¢ ~500ms(å¤§è§„æ¨¡) | <1M å‘é‡ |
| **Milvus** | å‘é‡ä¸“ç”¨ã€è¶…å¿«ã€åˆ†å¸ƒå¼ | éœ€å¦å¤–éƒ¨ç½² | >1M å‘é‡ |
| **Pinecone** | å®Œå…¨æ‰˜ç®¡ã€è‡ªåŠ¨æ‰©å±• | æŒ‰å‘é‡è®¡è´¹ | å¿«é€Ÿä¸Šçº¿ |
| **å†…å­˜å‘é‡** | é›¶å»¶è¿Ÿ | æ•°æ®ä¸¢å¤±é£é™© | å¼€å‘/æµ‹è¯• |

**å‘é‡é…ç½®**:
- ç»´åº¦:1536(OpenAI text-embedding-3-small)
- ç´¢å¼•ç±»å‹:HNSW
- ç›¸ä¼¼åº¦åº¦é‡:ä½™å¼¦ç›¸ä¼¼åº¦

**æˆæœ¬**:
- pgvector:å…è´¹
- Milvus:è‡ªæ‰˜ç®¡å…è´¹
- Pinecone:$0.25-1/M å‘é‡/æœˆ

### 3.5 AI æœåŠ¡éœ€æ±‚

**LLM æˆæœ¬ä¼°ç®—(æœˆåº¦)**

| æ¨¡å‹ | è¾“å…¥ä»·æ ¼ | è¾“å‡ºä»·æ ¼ | æœˆæˆæœ¬(10Kç”¨æˆ·) |
|------|---------|---------|----------------|
| GPT-4o-mini | $0.00015/1K | $0.0006/1K | ~$300 |
| GPT-4o | $0.005/1K | $0.015/1K | ~$10,000 |
| Claude 3.5 Sonnet | $0.003/1K | $0.015/1K | ~$6,000 |
| Grok-2 | $0.00002/1K | $0.0001/1K | ~$25 |

**åµŒå…¥æˆæœ¬**:
- OpenAI:$0.00002/1K tokens
- Voyage AI:$0.0001/1K tokens
- æœ¬åœ° BGE-Large:å…è´¹

**æœˆæˆæœ¬åˆ†è§£(10Kç”¨æˆ·)**:
- LLM(è®°å¿†æå–):$300
- åµŒå…¥(å‘é‡åŒ–):$50
- **æ€» AI æˆæœ¬:~$350/æœˆ**

**æ”¯æŒçš„æä¾›å•†**:
- OpenAI(gpt-4o, gpt-4o-mini)
- Anthropic(Claude 3.x)
- Google(Gemini)
- xAI(Grok)
- OpenRouter(ä»»ä½•æ”¯æŒçš„æ¨¡å‹)

### 3.6 ç½‘ç»œå’Œ CDN

**å¸¦å®½éœ€æ±‚**:

| åœºæ™¯ | æ•°æ®é‡ | é¢‘ç‡ | æœˆåº¦ |
|------|--------|------|------|
| èµ„æºä¸Šä¼  | 500KB-5MB | 10/ç”¨æˆ·/å‘¨ | 50GB |
| è®°å¿†æ£€ç´¢ | 10-50KB | 5/ç”¨æˆ·/å¤© | 5GB |
| API å“åº” | 1-10KB | æ¯ç§’æ•°ç™¾ | 50-100GB |

**æ¨èæ¶æ„**:
- CloudFlare/AWS CloudFront(CDN)
- API ç½‘å…³(è´Ÿè½½å‡è¡¡)
- åº”ç”¨æœåŠ¡å™¨ Ã— N

**SSL/TLS**:å…è´¹(Let's Encrypt)

### 3.7 éƒ¨ç½²å¤æ‚åº¦è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† (1-10) | è¯´æ˜ |
|------|-------------|------|
| **åŸºç¡€è®¾æ–½é…ç½®** | 6 | éœ€è¦é…ç½® PostgreSQLã€Redisã€LLM API å¯†é’¥ |
| **æ•°æ®åº“ç®¡ç†** | 7 | pgvector é…ç½®ã€å‘é‡ç´¢å¼•ç»´æŠ¤ã€åˆ†ç‰‡ç®¡ç† |
| **CI/CD å¤æ‚åº¦** | 5 | Python uv åŒ…ç®¡ç†,ä½† Rust æ‰©å±•ç¼–è¯‘æœ‰å¤æ‚æ€§ |
| **ç›‘æ§å’Œæ—¥å¿—** | 6 | éœ€è¿½è¸ª LLM è°ƒç”¨ã€å·¥ä½œæµæ‰§è¡Œã€å‘é‡æœç´¢æ€§èƒ½ |
| **æ€»ä½“å¤æ‚åº¦** | **6** | ä¸­ç­‰å¤æ‚åº¦,å…³é”®æ˜¯ LLM é›†æˆå’Œå‘é‡æœç´¢è°ƒä¼˜ |

### 3.8 æˆæœ¬ä¼°ç®—(æœˆåº¦)

**å°è§„æ¨¡éƒ¨ç½²(1,000æ´»è·ƒç”¨æˆ·)**
- è®¡ç®—:2vCPU, 4GB = $10-20
- æ•°æ®åº“:SQLite(æœ¬åœ°) = å…è´¹
- å­˜å‚¨:5GB æœ¬åœ° = å…è´¹
- å‘é‡ç´¢å¼•:pgvector = å…è´¹
- LLM API:GPT-4o-mini = $300
- åµŒå…¥ API:text-embedding-3-small = $50
- **æ€»è®¡:~$360/æœˆ**

**ä¸­ç­‰è§„æ¨¡(10,000ç”¨æˆ·)**
- è®¡ç®—:Kubernetes(3M+5W) = $1,000
- æ•°æ®åº“:PostgreSQL db.r5.xlarge = $800
- å­˜å‚¨:AWS S3 50GB = $1.25
- Redis:r5.large = $200
- LLM API:GPT-4o-mini = $3,000
- åµŒå…¥ API:$500
- ç½‘ç»œ:CloudFlare Pro = $200
- ç›‘æ§:DataDog = $300
- **æ€»è®¡:~$6,000/æœˆ**

**å¤§è§„æ¨¡(100,000+ç”¨æˆ·)**
- è®¡ç®—:Kubernetes(50+ nodes) = $10,000
- æ•°æ®åº“:PostgreSQL Citus(10åˆ†ç‰‡) = $5,000
- å­˜å‚¨:S3 500GB + CloudFront = $500
- Milvus é›†ç¾¤:$2,000
- Redis é›†ç¾¤:$1,000
- LLM API(æ··åˆæœ¬åœ°æ¨¡å‹):$30,000
- ç½‘ç»œ:ä¼ä¸š CDN = $2,000
- ç›‘æ§:ELK Stack = $2,000
- **æ€»è®¡:~$52,500/æœˆ**

### 3.9 å¿…éœ€çš„äº‘æœåŠ¡æ¸…å•

âœ… **å¿…éœ€**:
- LLM API(OpenAI/Grok/OpenRouter)
- åµŒå…¥ API(OpenAI/Voyage/æœ¬åœ°)
- å…ƒæ•°æ®æ•°æ®åº“(PostgreSQL/SQLite)
- åº”ç”¨æœåŠ¡å™¨(è™šæ‹Ÿä¸»æœº/Kubernetes)

âš ï¸ **æ¨è**:
- å‘é‡ç´¢å¼•(pgvector/Milvus)
- å¯¹è±¡å­˜å‚¨(S3/MinIO)
- CDN(CloudFlare/AWS CloudFront)
- ç¼“å­˜(Redis)
- APM(DataDog/New Relic)

ğŸ”§ **å¯é€‰**:
- æ¶ˆæ¯é˜Ÿåˆ—(RabbitMQ/Kafka)
- å›¾æ•°æ®åº“(Neo4j)
- Full-Text Search(Elasticsearch)
- WebSocket Gateway

---

## 4. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 4.1 MemoryService

**ä½ç½®**:`/src/memu/app/service.py`

ç»Ÿä¸€æœåŠ¡å…¥å£,æ•´åˆè®°å¿†å­˜å‚¨ã€æ£€ç´¢ã€ç®¡ç†åŠŸèƒ½ã€‚

**ä¸»è¦èŒè´£**:
- åˆå§‹åŒ– LLMã€æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿå®¢æˆ·ç«¯
- ç®¡ç†å·¥ä½œæµç®¡é“(memorize, retrieve_rag, retrieve_llm)
- æä¾›æ‹¦æˆªå™¨æ³¨å†Œæœºåˆ¶
- å»¶è¿Ÿåˆå§‹åŒ–é¿å…ç½‘ç»œå¼€é”€

### 4.2 è®°å¿†ç±»å‹ç³»ç»Ÿ

**ä½ç½®**:`/src/memu/prompts/memory_type/`

6 ç§æ ¸å¿ƒè®°å¿†ç±»å‹:
- **profile**:ç”¨æˆ·ä¸ªäººä¿¡æ¯(å¹´é¾„ã€èŒä¸šã€å…´è¶£)
- **event**:é‡è¦äº‹ä»¶å’Œå‘ç”Ÿè¿‡çš„äº‹æƒ…
- **knowledge**:å­¦åˆ°çš„çŸ¥è¯†å’Œäº‹å®
- **behavior**:è¡Œä¸ºæ¨¡å¼å’Œä¹ æƒ¯
- **skill**:æŒæ¡çš„æŠ€èƒ½å’Œä¸“é•¿
- **tool**:å·¥å…·ä½¿ç”¨ç»éªŒå’Œæœ€ä½³å®è·µ

### 4.3 è‡ªåŠ¨åˆ†ç±»ç³»ç»Ÿ

**ä½ç½®**:`/src/memu/app/settings.py`

10 ä¸ªé¢„å®šä¹‰åˆ†ç±»:
- personal_info(ä¸ªäººä¿¡æ¯)
- preferences(åå¥½è®¾ç½®)
- relationships(äººé™…å…³ç³»)
- activities(æ´»åŠ¨å’Œå…´è¶£)
- goals(ç›®æ ‡å’Œå¿—å‘)
- experiences(ç»å†å’Œäº‹ä»¶)
- knowledge(çŸ¥è¯†å’Œå­¦ä¹ )
- opinions(è§‚ç‚¹å’Œè§è§£)
- habits(ä¹ æƒ¯å’Œæ¨¡å¼)
- work_life(å·¥ä½œå’ŒèŒä¸š)

### 4.4 æ•°æ®æ¨¡å‹

**ä½ç½®**:`/src/memu/database/models.py`

```python
class Resource(BaseRecord):
    """åŸå§‹è¾“å…¥èµ„æº"""
    url: str
    modality: str  # conversation/document/image/video/audio
    local_path: str
    embedding: list[float]

class MemoryItem(BaseRecord):
    """å…·ä½“çš„è®°å¿†äº‹å®"""
    resource_id: str
    memory_type: str  # profile|event|knowledge|behavior|skill|tool
    summary: str
    embedding: list[float]
    happened_at: datetime
    extra: dict

class MemoryCategory(BaseRecord):
    """10ä¸ªé¢„å®šä¹‰åˆ†ç±»"""
    name: str
    description: str
    embedding: list[float]
    summary: str

class CategoryItem(BaseRecord):
    """å¤šå¯¹å¤šå…³ç³»"""
    item_id: str
    category_id: str
```

### 4.5 å·¥ä½œæµå¼•æ“

**ä½ç½®**:`/src/memu/workflow/step.py`

å·¥ä½œæµç®¡é“å®šä¹‰:
- è®°å¿†å­˜å‚¨ç®¡é“(memorize)
- RAG æ£€ç´¢ç®¡é“(retrieve_rag)
- LLM æ£€ç´¢ç®¡é“(retrieve_llm)
- CRUD æ“ä½œç®¡é“

**å…³é”®ç‰¹æ€§**:
- æ­¥éª¤é—´æ•°æ®æµç®¡ç†(requires/produces)
- æ‹¦æˆªå™¨æ”¯æŒ(before/after/on_error)
- æ”¯æŒé¡ºåºå’Œ DAG æ‰§è¡Œ

### 4.6 LLM å¤šæä¾›å•†æ”¯æŒ

**ä½ç½®**:`/src/memu/llm/`

æ”¯æŒçš„æä¾›å•†:
- OpenAI(gpt-4o, gpt-4o-mini)
- Grok(grok-2-latest)
- Qwen(qwen3-max)
- Doubao(via LazyLLM)
- OpenRouter(ä»»ä½•æ”¯æŒçš„æ¨¡å‹)

**å®¢æˆ·ç«¯åç«¯**:
- sdk:å®˜æ–¹ OpenAI SDK
- httpx:é€šç”¨ HTTP å®¢æˆ·ç«¯
- lazyllm_backend:LazyLLM æ¡†æ¶

---

## 5. æŠ€æœ¯æ ˆ

### 5.1 åç«¯

- **è¯­è¨€**:Python 3.13+
- **å¼‚æ­¥æ¡†æ¶**:asyncio, httpx 0.28.1+
- **ORM**:SQLModel 0.0.27+, Alembic 1.14.0+
- **æ•°æ®éªŒè¯**:Pydantic 2.12.4+

### 5.2 æ•°æ®åº“

- **å…³ç³»å‹**:SQLite, PostgreSQL
- **å‘é‡ç´¢å¼•**:pgvector 0.3.4+
- **å¯é€‰**:Milvus, Pinecone

### 5.3 AI æœåŠ¡

- **LLM**:openai 2.8.0+
- **åµŒå…¥**:sentence-transformers
- **å·¥ä½œæµ**:è‡ªå®šä¹‰å¼•æ“(æ— å¤–éƒ¨ä¾èµ–)

### 5.4 å¼€å‘å·¥å…·

- **åŒ…ç®¡ç†**:uv(æœ€æ–°)
- **Linting**:ruff 0.14.3+, mypy 1.18.2+
- **æµ‹è¯•**:pytest 8.4.2+, pytest-asyncio 0.24.0+
- **æ„å»º**:maturin 1.0+, pyo3 0.27.1+(Rust æ‰©å±•)

---

## 6. éƒ¨ç½²æ¶æ„

### 6.1 å¼€å‘ç¯å¢ƒ

```bash
git clone https://github.com/NevaMind-AI/memU.git
cd memU
make install  # ä½¿ç”¨ uv å®‰è£…
export OPENAI_API_KEY=sk-proj-xxx
python tests/test_inmemory.py
```

### 6.2 ç”Ÿäº§ç¯å¢ƒ

**Docker Compose**:
```yaml
version: '3.8'
services:
  postgres:
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_DB: memu
      POSTGRES_USER: memu
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  memu-api:
    build: .
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      DATABASE_URL: postgresql://memu:${DB_PASSWORD}@postgres:5432/memu
    ports:
      - "8000:8000"
```

### 6.3 Kubernetes éƒ¨ç½²

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: memu-api
spec:
  replicas: 5
  template:
    spec:
      containers:
      - name: memu
        image: ghcr.io/nevamind-ai/memu:latest
        resources:
          requests:
            memory: "4Gi"
            cpu: "2"
          limits:
            memory: "8Gi"
            cpu: "4"
```

---

## 7. å·¥ç¨‹å®è·µ

### 7.1 ä»£ç è´¨é‡

```bash
make check  # Ruff + mypy + deptry
uv run ruff check src/
uv run mypy src/
```

### 7.2 æµ‹è¯•

```bash
make test  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
tests/test_inmemory.py
tests/test_postgres.py
```

### 7.3 CI/CD

GitHub Actions è‡ªåŠ¨åŒ–:
- Lint Job:Ruff æ ¼å¼æ£€æŸ¥
- Security Job:Bandit + pip-audit
- Type Check:mypy
- Test Job:Python 3.10/3.11/3.12/3.13
- Coverage:Codecov ä¸Šä¼ 

---

## 8. å®‰å…¨å’Œéšç§

### 8.1 æ•°æ®åŠ å¯†

- ä¼ è¾“ä¸­:HTTPS/TLS 1.3
- å­˜å‚¨:PostgreSQL EBS åŠ å¯†æˆ– LUKS
- API å¯†é’¥:ç¯å¢ƒå˜é‡(ä¸ç¡¬ç¼–ç )

### 8.2 æ•°æ®éš”ç¦»

```python
class User(BaseModel):
    user_id: str
    workspace_id: str  # å¤šç§Ÿæˆ·

# æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤
where_filters = {"user_id": current_user_id}
```

### 8.3 åˆè§„æ€§

- GDPR:ç”¨æˆ·åˆ é™¤æƒã€æ•°æ®å¯¼å‡º
- å®¡è®¡æ—¥å¿—:æ‰€æœ‰ API è°ƒç”¨è®°å½•
- ä¿ç•™æœŸ:90 å¤©

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 ç¼“å­˜ç­–ç•¥

```python
@lru_cache(maxsize=1000)
async def get_categories(user_id: str):
    return await db.memory_category_repo.list(...)
```

### 9.2 å‘é‡æœç´¢ä¼˜åŒ–

```sql
CREATE INDEX ON memory_items USING hnsw (
    embedding vector_cosine_ops
) WITH (m = 16, ef_construction = 200);

SET hnsw.ef_search = 100;
```

### 9.3 æµå¼å¤„ç†

```python
async def process_large_file(path: str):
    chunk_size = 4096
    async with open(path) as f:
        while chunk := await f.read(chunk_size):
            yield await embed(chunk)
```

### 9.4 å¼‚æ­¥å¤„ç†

```python
async def memorize_with_background_tasks(resource_url):
    result = await store_memory(resource_url)
    asyncio.create_task(update_category_summaries())
    return result
```

---

## 10. æ€»ç»“

memU çš„æ¶æ„è®¾è®¡ä½“ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŸåˆ™:

1. **åˆ†å±‚è®°å¿†æ¶æ„** - æ–‡ä»¶ç³»ç»Ÿéšå–»ä½¿è®°å¿†ç»„ç»‡ç›´è§‚æ˜“ç”¨
2. **æˆæœ¬ä¼˜å…ˆ** - åŒæ¨¡æ€æ£€ç´¢å¹³è¡¡æˆæœ¬å’Œç²¾åº¦
3. **å®æ—¶å¯ç”¨** - é›¶å»¶è¿Ÿå¤„ç†,æ–°è®°å¿†ç«‹å³å¯æŸ¥è¯¢
4. **çµæ´»å¯æ‰©å±•** - å·¥ä½œæµç³»ç»Ÿæ”¯æŒæ·±åº¦å®šåˆ¶
5. **ç”Ÿäº§å°±ç»ª** - ä¸¥æ ¼ç±»å‹æ£€æŸ¥ã€å®Œæ•´æµ‹è¯•ã€ä¼ä¸šçº§å®‰å…¨

**é€‚ç”¨åœºæ™¯**:
- 24/7 é•¿æœŸè¿è¡Œçš„ AI ä»£ç†
- éœ€è¦ç†è§£ç”¨æˆ·æ„å›¾çš„ä¸ªäººåŠ©æ‰‹
- å¤šè½®å¤æ‚å¯¹è¯çš„ä¸Šä¸‹æ–‡ç®¡ç†
- éœ€è¦æˆæœ¬ä¼˜åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²

**äº‘æœåŠ¡æ¨è**:

| è§„æ¨¡ | æ¨èé…ç½® | æˆæœ¬ |
|------|--------|------|
| å°å‹(1K) | SQLite + æœ¬åœ° + OpenAI API | ~$360/æœˆ |
| ä¸­å‹(10K) | PostgreSQL + Kubernetes + OpenAI | ~$6K/æœˆ |
| å¤§å‹(100K+) | Citus é›†ç¾¤ + Milvus + æ··åˆæ¨¡å‹ | ~$52K/æœˆ |

---

**æ–‡æ¡£ç‰ˆæœ¬**:v1.0
**æ›´æ–°æ—¥æœŸ**:2025-02-12
**åŸºç¡€ç‰ˆæœ¬**:memU v1.4.0
**Python ç‰ˆæœ¬**:3.13+
